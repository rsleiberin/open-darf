# Provenance Guide (Pointer)

Implement PROV-O with Entities/Activities/Agents and record ingestion, bias, and extraction events.
Initial Cypher patterns are generated by apps/provenance/prov_logging.py.
Production wiring adds driver sessions, retention, and C2PA-style manifests.

## Write Path
- Module: `apps/provenance/neo4j_write.py`
- Env: `NEO4J_URI`, `NEO4J_USER`, `NEO4J_PASSWORD`
- Function: `write_ingestion_event(ev, driver=None)` â€” accepts injected driver for tests; uses env when not provided.

## Ingestion Upload
- Module: `apps/document_processor/upload.py`
- Functions: `upload_bytes(...)`, `upload_file(...)`
- Behavior: inject a MinIO-compatible client with `put_object(...)`. We infer content-type (e.g., markdown/json/pdf) and construct deterministic object keys under `UPLOAD_PREFIX` (default `docs/`).

## Neo4j Schema
- Module: `apps/provenance/schema.py`
- Functions: `constraint_statements()`, `apply_constraints(driver)`
- Idempotent: uses `IF NOT EXISTS` for constraints/indexes; safe to re-run in CI and at startup.

## Anchor Vector Store
- Module: `tools/qdrant_bootstrap.py`
- Functions: `collection_config(...)`, `ensure_collection(client, ...)`
- Client: inject a Qdrant-like client exposing `get_collection` and `create_collection`.
- Defaults: `size=1024`, `distance=Cosine`, `name=anchors`. Safe to re-run in CI and at startup.

## Bias Filtration
- Module: `apps/document_processor/bias.py`
- Functions: `score_bias(text, threshold=0.5) -> BiasResult`, `filter_segments(list[str], threshold=0.5)`
- Gold set for toy validation: `tests/golden/bias/gold.jsonl` (micro-F1 gate in `tests/unit/test_bias.py`).
- This is a transparent CBDT-style heuristic (deterministic); replaceable with ML as research matures.
