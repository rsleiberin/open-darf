---
id: ADR-2508-VEN-004
legacy_id: 0004-message-broker
type: VEN
implements_concept: null  # Will create CON ADR for message broker
status: accepted
date: 2025-08-03
title: "RabbitMQ 3 adopted as default message broker"

decision_confidence: 9
time_investment: "3_hours"
main_tradeoff: "reliability vs complexity"
alternatives_rejected: ["redis_streams", "kafka", "activemq", "nats"]
reevaluate_when: "high_throughput_streaming_required OR event_sourcing_needed"

supersedes: null
superseded_by: null
research_basis: "Janus Backend Architecture – Onboarding Brief"
linked_evidence:
  - "../reference/Janus Backend Architecture – Onboarding Brief.pdf"
  - "../reference/Redis vs RabbitMQ as Dramatiq Brokers – A Durable Self‑Hosted Task Queue Comparison.pdf"

tags: ["messaging", "broker", "async", "reliability"]
---

# ADR 0004 – RabbitMQ 3 adopted as default message broker

## Decision

RabbitMQ selected as the message broker for asynchronous communication and task distribution in Janus's distributed agent architecture.

## Context

Janus requires reliable message passing between agent processes and system components. The broker enables decoupled communication, background task queuing, and coordination between multiple agent instances while ensuring message durability and delivery guarantees.

## Rationale

**Proven Reliability**: RabbitMQ excels in scenarios requiring strong delivery guarantees with acknowledgments, message persistence, and robust failure handling - critical for agent task coordination.

**Lightweight Resource Footprint**: Despite enterprise-grade capabilities, RabbitMQ runs efficiently on low-power devices (documented Raspberry Pi deployments) while handling decent workloads.

**Advanced Routing Capabilities**: Supports complex message routing patterns through exchanges, topics, and queues - enabling sophisticated agent communication patterns beyond simple task queuing.

**Back-pressure Management**: Unlike in-memory solutions, RabbitMQ handles consumer slowdowns gracefully by queuing messages and applying flow control to prevent system overload.

**Direct Dramatiq Integration**: Native support as a Dramatiq broker enables seamless task queue implementation without custom integration overhead.

## Research Foundation

Comprehensive analysis in "Janus Backend Architecture – Onboarding Brief" evaluated:

- **Redis Streams**: Rejected due to single-threaded limitations, lack of natural back-pressure, and memory growth concerns under load
- **Apache Kafka**: Over-engineered for moderate workloads, JVM overhead and Zookeeper complexity inappropriate for edge deployment
- **ActiveMQ/NATS**: Comparable features to RabbitMQ but smaller community and less mature Python ecosystem
- **ZeroMQ**: Lower-level library requiring custom reliability implementation

Research emphasized RabbitMQ's "ready solution with minimal fuss" approach versus building custom message handling.

## Consequences

### Positive
- Guaranteed message delivery with configurable durability
- Fair dispatch and load balancing across agent workers
- Priority queues and delayed message capabilities for advanced scheduling
- Rich management UI for operational visibility
- Proven scalability path through clustering and federation

### Negative
- Additional service to deploy and monitor
- More complex than Redis for simple pub/sub scenarios
- Requires understanding of AMQP concepts for optimal usage

### Neutral
- AMQP protocol - standardized but domain-specific
- Memory usage grows with queue depth (expected behavior)

## Implementation Notes

- **Task Distribution**: Primary broker for Dramatiq background task execution
- **Agent Coordination**: Enables multi-agent communication patterns
- **Configuration**: Optimized for durability with acceptable performance overhead
- **Monitoring**: Management plugin provides queue depth and throughput metrics

## Success Criteria

- [ ] Zero message loss during planned system restarts
- [ ] Fair task distribution across multiple agent workers
- [ ] Acceptable latency for task delivery (sub-second for normal priority)
- [ ] Graceful handling of worker failures and restarts
- [ ] Queue depth monitoring and alerting capabilities

## Relationships

- **ENABLES**: Dramatiq task queue, agent coordination, system resilience
- **INTEGRATES_WITH**: All agent services requiring async communication
- **SUPPORTS**: Background processing, distributed agent architectures
