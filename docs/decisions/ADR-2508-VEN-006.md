---
id: ADR-2508-VEN-006
legacy_id: 0006-relational-db
type: VEN
implements_concept: null  # Will create CON ADR for this
status: accepted
date: 2025-08-03
title: "PostgreSQL 15 chosen as relational store"

decision_confidence: 9
time_investment: "6_hours"
main_tradeoff: "feature_richness vs simplicity"
alternatives_rejected: ["mysql", "sqlite", "cockroachdb"]
reevaluate_when: "concurrent_write_bottlenecks OR multi_node_requirements"

supersedes: null
superseded_by: null
research_basis: "Janus Backend Architecture – Onboarding Brief"
linked_evidence:
  - "../reference/Janus Backend Architecture – Onboarding Brief.pdf"
  - "../reference/Building a Universal, ACID-Compliant Backend Tech Stack.pdf"

tags: ["database", "relational", "acid", "offline-first"]
---

# ADR 0006 – PostgreSQL 15 chosen as relational store

## Decision

PostgreSQL 15 selected as the primary relational database for Janus, interfaced through SQLAlchemy ORM with Alembic for migrations.

## Context

Janus requires a relational database for canonical structured data: agent configurations, user accounts/permissions, audit logs of agent actions, and other structured records requiring ACID compliance. The database must support offline operation and scale from single-machine deployment to potential clustering.

## Rationale

**Proven Enterprise-Grade Reliability**: PostgreSQL provides full ACID compliance with a track record for data integrity - essential for core agent state and audit logs.

**Offline-First Compatibility**: Runs efficiently on minimal hardware (Raspberry Pi to servers) while maintaining performance characteristics suitable for concurrent agent operations.

**Rich Feature Set for Future Needs**: 
- JSONB support for semi-structured data
- Advanced indexing options and materialized views
- Full-text search capabilities
- Extensibility (PostGIS, TimescaleDB if needed)

**Python Ecosystem Integration**: Excellent async support and SQLAlchemy compatibility enables seamless integration with the agent runtime.

**ARM64 & Resource Efficiency**: Mature ARM64 builds with configurable memory footprint for edge deployment scenarios.

## Research Foundation

Based on comprehensive analysis in "Janus Backend Architecture – Onboarding Brief" which evaluated:

- **MySQL/MariaDB**: Rejected due to PostgreSQL's superior JSON support, more permissible licensing, and stronger extension ecosystem
- **SQLite**: Insufficient for multi-process agent architecture and scaling requirements
- **NoSQL/NewSQL**: Inappropriate for structured, transactional data requiring strong consistency guarantees

The research emphasized PostgreSQL's ability to "start small but scale up" - critical for the offline-first to cloud-burst architecture.

## Consequences

### Positive
- Strong data integrity guarantees for agent state
- Rich query capabilities for complex agent coordination
- Proven scalability path from single-node to clustered deployments
- Excellent tooling ecosystem for backup, monitoring, and maintenance

### Negative
- More complex than SQLite for simple use cases
- Requires database administration knowledge for optimization
- Memory overhead compared to embedded solutions

### Neutral
- Standard SQL interface - familiar to developers
- Well-documented operational procedures

## Implementation Notes

- **ORM Strategy**: SQLAlchemy provides abstraction while preserving PostgreSQL-specific features
- **Migration Management**: Alembic handles schema evolution safely
- **Configuration**: Optimized for low-memory environments with scaling headroom
- **Backup Strategy**: pg_dump for regular backups, WAL archiving for point-in-time recovery

## Success Criteria

- [ ] Agent state persistence across restarts
- [ ] Concurrent agent operations without data corruption
- [ ] Acceptable performance on target hardware (Pi 4 minimum)
- [ ] Successful backup/restore procedures
- [ ] Clean migration path for schema changes

## Relationships

- **ENABLES**: Agent state management, audit logging, user authentication
- **SUPPORTS**: Multi-agent coordination via shared state
- **INTEGRATES_WITH**: All agent services requiring persistent structured data
