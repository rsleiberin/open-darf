name: CI Gates

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  gates:
    name: CI Gates
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Emit gates.json (from pinned validation)
        run: |
          python scripts/emit_perf_and_constitution.py \
            --eval var/receipts/phase6c/validation \
            --out  var/reports/phase6c/gates.json

      - name: Verify gates (presence + non-regression)
        run: |
          python scripts/ci_verify_gates.py

      - name: Print scoreboard
        run: |
          python scripts/print_scoreboard.py

      - name: Upload gates.json artifact
        uses: actions/upload-artifact@v4
        with:
          name: gates-json
          path: var/reports/phase6c/gates.json
