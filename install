#!/usr/bin/env bash
set -euo pipefail
echo "DARF Open Source Installation"
echo "============================"

# Check if Docker is available
if ! command -v docker &> /dev/null; then
    echo "Error: Docker is required but not installed"
    echo "Please install Docker and try again"
    exit 1
fi

# Check if Docker Compose is available  
if ! command -v docker-compose &> /dev/null && ! docker compose version &> /dev/null; then
    echo "Error: Docker Compose is required but not available"
    echo "Please install Docker Compose and try again"
    exit 1
fi

# Create necessary directories
mkdir -p var/receipts/open-darf var/reports

# Start infrastructure
echo "Starting DARF infrastructure..."
docker-compose up -d

# Wait for services to be ready
echo "Waiting for services to initialize..."
sleep 30

echo "Installation complete!"
echo "Run './validate' to test the system"
