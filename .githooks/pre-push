#!/usr/bin/env bash
set -e

current_branch=$(git symbolic-ref --quiet --short HEAD)

if [[ "$current_branch" != "main" ]]; then
    git fetch -q origin main
    read ahead behind <<<"$(git rev-list --left-right --count "$current_branch"...origin/main)"
    if [[ "$behind" -ne 0 ]]; then
        echo "❌  Branch is behind origin/main. Run: git pull --rebase origin main" >&2
        exit 1
    fi
fi
